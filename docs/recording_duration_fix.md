# 录制时长计算说明

## 📊 时间计算逻辑

### 问题背景
之前的版本在显示"实际录制时长"时会多出2秒，这是因为包含了录制结束后的延时等待时间。

### 修复方案
现在程序会准确记录录制的开始和结束时间，确保显示的时长就是真实的视频录制时长。

## ⏱️ 时间线详解（以5秒录制为例）

```
时间轴: 0s -----> 2s -----> 7s -----> 9s
       点击     开始      录制      窗口
       开始     录制      结束      弹出
```

### 各个时间段的作用

1. **0-2秒：准备阶段**
   - 用户点击"开始录制"
   - 显示准备状态
   - 给用户时间切换到要录制的内容

2. **2-7秒：实际录制阶段**
   - 窗口最小化
   - 开始真正的视频录制
   - 录制时长：5秒（用户设定值）

3. **7-9秒：结束阶段**
   - 停止录制
   - 等待2秒缓冲时间
   - 然后弹出完成提示

## 🎯 关键修复内容

### 之前的问题
```cpp
// 错误：包含了延时时间
qint64 duration = QDateTime::currentMSecsSinceEpoch() - recordStartTime;
// 结果：显示7秒（包含了录制结束后的2秒延时）
```

### 修复后的正确计算
```cpp
// 正确：只计算真实录制时间
recordEndTime = QDateTime::currentMSecsSinceEpoch(); // 录制结束时立即记录
qint64 actualRecordingTime = recordEndTime - recordStartTime;
// 结果：显示5秒（真实录制时长）
```

## 📋 验证方法

### 定时录制测试
1. 设置录制时长为5秒
2. 点击开始录制
3. 等待整个流程完成
4. 检查最终提示的"实际录制时长"

### 预期结果
- **实际录制时长**：00:00:05（设定值）
- **视频文件时长**：约5秒
- **总流程时长**：约9秒

### 手动停止测试
1. 设置任意时长
2. 点击开始录制
3. 在录制过程中手动点击停止
4. 检查显示的录制时长

### 预期结果
- 显示的时长 = 从开始录制到手动停止的真实时间
- 不包括准备时间和延时时间

## 🔧 技术实现

### 新增变量
```cpp
qint64 recordEndTime; // 记录录制结束的精确时间
```

### 关键时间点记录
```cpp
// 开始录制时
recordStartTime = QDateTime::currentMSecsSinceEpoch();

// 停止录制时（定时或手动）
recordEndTime = QDateTime::currentMSecsSinceEpoch();

// 计算真实录制时长
qint64 actualTime = recordEndTime - recordStartTime;
```

## ✅ 验证检查清单

- [ ] 设定5秒录制，最终显示"实际录制时长: 00:00:05"
- [ ] 设定10秒录制，最终显示"实际录制时长: 00:00:10"
- [ ] 手动停止录制，显示的时长与实际录制时间一致
- [ ] 录制的视频文件时长与显示的时长匹配
- [ ] 不包含准备时间和延时时间

---

**现在的时间计算完全准确，显示的"实际录制时长"就是视频文件的真实时长！** ⏱️✨
